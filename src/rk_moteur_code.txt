	;; RK - Evalbot (Cortex M3 de Texas Instrument)
; programme - Pilotage 2 Moteurs Evalbot par PWM tout en ASM (Evalbot tourne sur lui même)



		AREA    |.text|, CODE, READONLY
		ENTRY
		EXPORT	__main
		
		;; The IMPORT command specifies that a symbol is defined in a shared object at runtime.
		IMPORT	MOTEUR_INIT					; initialise les moteurs (configure les pwms + GPIO)
		; IMPORT BUMPER_INIT					; initialise les bumpers
		
		IMPORT	MOTEUR_DROIT_ON				; activer le moteur droit
		IMPORT  MOTEUR_DROIT_OFF			; déactiver le moteur droit
		IMPORT  MOTEUR_DROIT_AVANT			; moteur droit tourne vers l'avant
		IMPORT  MOTEUR_DROIT_ARRIERE		; moteur droit tourne vers l'arrière
		IMPORT  MOTEUR_DROIT_INVERSE		; inverse le sens de rotation du moteur droit
		
		IMPORT	MOTEUR_GAUCHE_ON			; activer le moteur gauche
		IMPORT  MOTEUR_GAUCHE_OFF			; déactiver le moteur gauche
		IMPORT  MOTEUR_GAUCHE_AVANT			; moteur gauche tourne vers l'avant
		IMPORT  MOTEUR_GAUCHE_ARRIERE		; moteur gauche tourne vers l'arrière
		IMPORT  MOTEUR_GAUCHE_INVERSE		; inverse le sens de rotation du moteur gauche
		
		; IMPORT	BUMPER_VALUE				; récupère la valeur d'activation du bumper


__main	


		;; BL Branchement vers un lien (sous programme)

		; Configure les PWM + GPIO
		BL	MOTEUR_INIT	   		
		; BL	BUMPER_INIT
		
		; Activer les deux moteurs droit et gauche
		BL	MOTEUR_DROIT_ON
		BL	MOTEUR_GAUCHE_ON

		; Boucle de pilotage des 2 Moteurs (Evalbot tourne sur lui même)
loop	
		


		
		; Evalbot avance droit devant jusqu a la detection des bumpers
;Roule_avant
		BL	MOTEUR_DROIT_AVANT	   
		BL	MOTEUR_GAUCHE_AVANT
		
		BL WAIT

;Recul
		; Rotation à droite de l'Evalbot pendant une demi-période (1 seul WAIT)
		BL	MOTEUR_DROIT_ARRIERE   ; MOTEUR_DROIT_INVERSE
		BL	MOTEUR_GAUCHE_ARRIERE  ; MOTEUR_GAUCHE_INVERSE
		
		BL WAIT
		
;Tournant a angle droit pour regarder le mur droit
		BL	MOTEUR_DROIT_ARRIERE   ; MOTEUR_DROIT_INVERSE
		BL	MOTEUR_GAUCHE_INVERSE  ; MOTEUR_GAUCHE_INVERSE

		BL WAIT
		
		;avance vers le mur jusqu a la detection du mur
		BL	MOTEUR_DROIT_AVANT   ; MOTEUR_DROIT_INVERSE
		BL	MOTEUR_GAUCHE_AVANT  ; MOTEUR_GAUCHE_INVERSE

		BL WAIT
		
		;tournant a 180 degres pour voir le mur cote oppose
		BL	MOTEUR_DROIT_ARRIERE   ; MOTEUR_DROIT_INVERSE
		BL	MOTEUR_GAUCHE_AVANT  ; MOTEUR_GAUCHE_INVERSE
		
		BL WAIT
		BL WAIT
		
		;avance vers le mur jusqu a ce que les bumpers s activent 
		BL MOTEUR_DROIT_AVANT
		BL MOTEUR_GAUCHE_AVANT
		
		BL WAIT
		
		BL MOTEUR_DROIT_ARRIERE
		BL MOTEUR_GAUCHE_ARRIERE
		
		BL WAIT
		
		BL MOTEUR_GAUCHE_AVANT
		
		BL WAIT
		
		
		
		b	loop

		;; Boucle d'attente
WAIT	ldr r1, =0x15FFFFE ;0xAFFFFF
wait1	subs r1, #1
        bne wait1
		

		
		;; retour à la suite du lien de branchement
		BX	LR

		NOP
        END